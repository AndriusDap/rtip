
module RailTech {
  export module ThingsToDo {

    export class ThingsToDoService {

      public events;
      public ticket;
      public journey;

      private thingsToDoUrl = "/api/igeolise/events";

      static $inject = [
      "$http",
      "$q",
      "$timeout",
      "$ionicModal",
      "$rootScope"];

      constructor(
          private $http,
          private $q,
          private $timeout, 
          private $ionicModal,
          private $rootScope) {

      }

      public findThingsToDo(location, travelTime, startTime, toc) {
        console.log(location.lat + ", " + location.lng + ", " + location.city + ", " + travelTime + ", " + startTime + ", " + toc)

        var deferred = this.$q.defer();

        var request = {
          "coords": [location.lat, location.lng],
          "city": location.city,
          "travel_time": travelTime,
          "start_time": startTime,
          "toc": "GWR"
        };

        this.$http.post(this.thingsToDoUrl, request)
          .then((response) => {
            
            this.events = response["data"]["results"];
            deferred.resolve(this.events);

          });

        // this.events = [{ "event": { "id": 31, "name": "Oxford Spires Hotel", "city": "Oxford", "image": "N/A", "price": 0, "expires": "N/A", "location": "Abingdon Road, Oxford, OX1 4PS", "phone": "01865 324 324", "description": "10% off best available rates\nThis 4 star hotel is surrounded by a huge range of unique local attractions, making it perfect for all types of travellers.\n\nThe hotel has a pool, gym and a spa. Guests can also make use of Willows Leisure Club, which includes a sauna and steam room. This offer also includes free breakfast.\n\nHow to get this offer\n\nJust fill in the form below. We'll send you a voucher by email, with instructions on how to redeem it. When you use the offer, you'll also need to show a GWR train ticket (or proof of travel on a GWR train) from the previous 7 days.\n\nOffer details: Terms and Conditions\n\nbookings are subject to availability\ncannot to be used in conjunction with any other offer", "website": "https://www.gwr.com/explore-the-west/offers/2016/march/oxford-spires-hotel", "type": "Places to stay", "theme": "City break / History and heritage / Romantic break", "coords": [51.7375, -1.251989] }, "route": { "departure": "2016-05-02T11:07:27.000+02:00", "arrival": "2016-05-02T15:13:37.000+02:00", "time": 14770, "distance": 672, "num_trips": 5, "parts": [{ "mode": "walk", "coords": [[51.51, -0.14]], "directions": "Start your journey 16 meters west", "distance": 16, "time": 11, "direction": "west", "id": 0 }, { "mode": "walk", "coords": [[51.5099924, -0.1402405], [51.5100947, -0.1399182], [51.510121, -0.1398087], [51.510128, -0.1396831]], "directions": "Walk 41 meters along Burlington Gardens", "distance": 41, "time": 30, "road": "Burlington Gardens", "id": 1 }, { "mode": "walk", "coords": [[51.510128, -0.1396831], [51.5101593, -0.1395111], [51.5102629, -0.1389583], [51.5103655, -0.1384156]], "directions": "Continue onto Vigo Street for 91 meters", "distance": 91, "time": 75, "road": "Vigo Street", "turn": "straight", "id": 2 }, { "mode": "walk", "coords": [[51.5103655, -0.1384156], [51.5103283, -0.1383792], [51.5102766, -0.1383082], [51.5101624, -0.1381542], [51.5100703, -0.1379606], [51.5099827, -0.1377347], [51.5099618, -0.1376909], [51.5099151, -0.1375237], [51.5098722, -0.1373361], [51.5098325, -0.1371314], [51.5098129, -0.1369727], [51.5097959, -0.136879], [51.5097732, -0.1366245], [51.5097719, -0.1363498], [51.5097827, -0.1361221], [51.5097933, -0.1360069], [51.5098171, -0.1358443], [51.5098417, -0.1356675], [51.5098944, -0.1354104], [51.5099342, -0.1352801]], "directions": "Slight right and walk 238 meters", "distance": 238, "time": 174, "turn": "slight_right", "id": 3 }, { "mode": "walk", "coords": [[51.5099342, -0.1352801], [51.509925194, -0.1352547226], [51.5095961675, -0.1349222882]], "directions": "Enter 'Piccadilly Circus Underground Station' through 'Entrance 2'", "distance": 45, "time": 303, "id": 4 }, { "mode": "rail_underground", "coords": [[51.5095961675, -0.1349222882], [51.5071264216, -0.1419257939], [51.5027889777, -0.1531252362], [51.5014676599, -0.1611754879], [51.4940216924, -0.173259557], [51.4942371657, -0.1830760886], [51.491783821, -0.1936609092], [51.4904029733, -0.2138826615], [51.4924267426, -0.2239739979], [51.4952689289, -0.2545495541], [51.5028110112, -0.2799236465], [51.5010880479, -0.3073643628], [51.499672985, -0.3133816498], [51.4956090811, -0.3247255765], [51.4814524067, -0.3518450727], [51.4736070876, -0.356058956], [51.4713389075, -0.3662052905], [51.4734260392, -0.3857428067], [51.4663963846, -0.4235964604], [51.471329352, -0.4523246495]], "directions": "Take a train (Piccadilly line) from 'Piccadilly Circus Underground Station' (leaves at 10:17) to 'Heathrow Terminals 1-2-3 Underground Station' (arrives at 10:52) (19 stops)", "distance": 0, "time": 2100, "line": "Piccadilly", "departure_station": "Piccadilly Circus Underground Station", "arrival_station": "Heathrow Terminals 1-2-3 Underground Station", "depart_time": "10:17", "arrive_time": "10:52", "num_stops": 19, "id": 5 }, { "mode": "walk", "coords": [[51.471329352, -0.4523246495], [51.4714173368, -0.4521776845], [51.4713689, -0.4520499]], "directions": "Exit 'Heathrow Terminals 1-2-3 Underground Station' through 'Entrance 3'", "distance": 24, "time": 315, "id": 6 }, { "mode": "walk", "coords": [[51.4713689, -0.4520499], [51.4717205, -0.4523491]], "directions": "Walk 44 meters along Inner Ring East", "distance": 44, "time": 32, "road": "Inner Ring East", "id": 7 }, { "mode": "walk", "coords": [[51.4717205, -0.4523491], [51.4716829422, -0.4525430635], [51.4716844, -0.4525728]], "directions": "Enter 'Heathrow Central Bus Station' through 'Stand 16-17'", "distance": 16, "time": 23, "id": 8 }, { "mode": "walk", "coords": [[51.4716844, -0.4525728], [51.4715836, -0.4526365], [51.4714869, -0.4527361], [51.4714065, -0.4528189], [51.4713857, -0.4529466], [51.4713784, -0.4530848], [51.4713906, -0.4534211]], "directions": "Walk 75 meters", "distance": 75, "time": 56, "id": 9 }, { "mode": "walk", "coords": [[51.4713906, -0.4534211], [51.4713711309, -0.453446335]], "directions": "Go to 'Heathrow Central Bus Station, Stand 19'", "distance": 2, "time": 4, "id": 10 }, { "mode": "bus", "coords": [[51.4713711309, -0.453446335], [51.5033544443, -0.4511821627], [51.5365867192, -0.4707747536], [51.5475272947, -0.4767539216], [51.5480912041, -0.4814081026], [51.5534154149, -0.4884286416], [51.5557373703, -0.4906741324], [51.5659442683, -0.5012440909], [51.5677204416, -0.5037251941], [51.5714944505, -0.5205279514], [51.5729303151, -0.5267298168], [51.5739843631, -0.5326268802], [51.5748448638, -0.5374480755], [51.57603524, -0.5420568526], [51.5773480597, -0.5485814246], [51.5798723254, -0.5542019721], [51.5822407119, -0.5574032228], [51.5836938496, -0.5593057951], [51.586757768, -0.5627743209], [51.5913244528, -0.5759405937], [51.5916726322, -0.5831624144], [51.5946966852, -0.5953546162], [51.5980029321, -0.6079440667], [51.6019680207, -0.6308397796], [51.6015985165, -0.6377241524], [51.5990935062, -0.6497255741], [51.5992640642, -0.6598999046], [51.599386815, -0.6643579048], [51.5994275316, -0.6703199698], [51.6023056711, -0.686350694], [51.6051099069, -0.691064057], [51.6074670614, -0.6960218707], [51.6104964441, -0.7008021379], [51.6116897921, -0.7030066893], [51.6150156075, -0.7086027336], [51.6160969091, -0.7120819624], [51.6183672327, -0.7165822572], [51.6192830429, -0.7181020481], [51.6208209471, -0.721424536], [51.6226561766, -0.727295885], [51.6232899616, -0.7310197636], [51.6254460004, -0.7366661966], [51.6267998438, -0.7429999287], [51.6279505031, -0.748862843], [51.6286561373, -0.7492624234], [51.6307583352, -0.7533080405], [51.6311551297, -0.7568082315]], "directions": "Take a bus (A40) from 'Heathrow Central Bus Station' (leaves at 11:10) to 'Bus Station' (arrives at 12:17) (46 stops)", "distance": 0, "time": 4658, "line": "A40", "departure_station": "Heathrow Central Bus Station", "arrival_station": "Bus Station", "depart_time": "11:10", "arrive_time": "12:17", "num_stops": 46, "id": 11 }, { "mode": "walk", "coords": [[51.6311551297, -0.7568082315], [51.6311561, -0.7568057]], "directions": "", "distance": 0, "time": 0, "id": 12 }, { "mode": "walk", "coords": [[51.6311561, -0.7568057], [51.631252, -0.7566253], [51.6314135, -0.756293]], "directions": "Walk 45 meters", "distance": 45, "time": 33, "id": 13 }, { "mode": "walk", "coords": [[51.6314135, -0.756293], [51.6314106209, -0.7563099829]], "directions": "Enter 'High Wycombe Bus Station Bay 11 Gate D' and go to 'Bay 13'", "distance": 1, "time": 2, "id": 14 }, { "mode": "bus", "coords": [[51.6314106209, -0.7563099829], [51.6312083925, -0.7601444618], [51.6305370813, -0.7629946994], [51.6289904308, -0.7638458674], [51.6261694015, -0.7649338521], [51.6227521723, -0.7657633959], [51.6178263757, -0.766792601], [51.6149665757, -0.7684733648], [51.6082563127, -0.7708356333], [51.6001771671, -0.7695665748], [51.5937416544, -0.7664055513], [51.5851867297, -0.7660743294], [51.5837268935, -0.7615094995], [51.5811516359, -0.7611753921], [51.5788055847, -0.7655255583], [51.575521139, -0.7713004318], [51.5732719326, -0.7754881931], [51.5705249965, -0.7793858446], [51.5684159622, -0.7858487664], [51.5658396242, -0.7897552679], [51.5640857163, -0.8010985865], [51.5609513484, -0.8103130049], [51.5583153719, -0.8155173305], [51.5570764703, -0.8219687642], [51.5540969162, -0.8270365587], [51.5525132379, -0.8296303109], [51.553321829, -0.839518894], [51.5553829912, -0.84976568], [51.5587381418, -0.8683768144], [51.5637240345, -0.8838489704], [51.56195967, -0.8940918765], [51.5608172682, -0.8978704464], [51.5559892585, -0.9017808827], [51.5454222015, -0.9035495748], [51.5398273544, -0.9043185075], [51.5375723095, -0.9035651962]], "directions": "Take a bus (800) from 'Bus Station' (leaves at 12:35) to 'Hart Street' (arrives at 13:20) (35 stops)", "distance": 0, "time": 3741, "line": "800", "departure_station": "Bus Station", "arrival_station": "Hart Street", "depart_time": "12:35", "arrive_time": "13:20", "num_stops": 35, "id": 15 }, { "mode": "bus", "coords": [[51.5375723095, -0.9035651962], [51.5405497861, -0.9046472362], [51.5432022925, -0.9084915803], [51.544342642, -0.9112187328], [51.5528593178, -0.9240256984], [51.5601400964, -0.951537585], [51.5752458421, -0.9883350804], [51.579331928, -1.0141355826], [51.5840993181, -1.0261855124], [51.5952974262, -1.0540696039], [51.606959825, -1.07779901], [51.6127744512, -1.0866067365], [51.6200621257, -1.0802490906], [51.6242471792, -1.0841949867], [51.6236138599, -1.0987982845], [51.6220977073, -1.102771969], [51.6211176574, -1.1063159472], [51.6195983117, -1.1134670769], [51.6194710844, -1.1144806887]], "directions": "Take a bus (139) from 'Hart Street' (leaves at 13:22) to 'Benson Marina' (arrives at 13:48) (18 stops)", "distance": 0, "time": 1723, "line": "139", "departure_station": "Hart Street", "arrival_station": "Benson Marina", "depart_time": "13:22", "arrive_time": "13:48", "num_stops": 18, "id": 16 }, { "mode": "bus", "coords": [[51.6194710844, -1.1144806887], [51.630584794, -1.1398666315], [51.6316285206, -1.1424187389], [51.649670433, -1.161721735], [51.6616601767, -1.1788068616], [51.6758635806, -1.1925787392], [51.6872641698, -1.2003468338], [51.6895522527, -1.2022884917], [51.7326617746, -1.249272677], [51.7346748083, -1.2505136802], [51.7372645167, -1.2519480185]], "directions": "Take a bus (X39) from 'Benson Marina' (leaves at 13:53) to 'Lincoln Road' (arrives at 14:12) (10 stops)", "distance": 0, "time": 1443, "line": "X39", "departure_station": "Benson Marina", "arrival_station": "Lincoln Road", "depart_time": "13:53", "arrive_time": "14:12", "num_stops": 10, "id": 17 }, { "mode": "walk", "coords": [[51.7372645167, -1.2519480185], [51.737539, -1.2520233]], "directions": "", "distance": 30, "time": 44, "id": 18 }, { "mode": "walk", "coords": [[51.7375, -1.251989]], "directions": "Your destination is 4 meters southeast", "distance": 4, "time": 3, "direction": "southeast", "id": 19 }], "fares": [], "fares_total": [] }, "travel_time": 14770 }, { "event": { "id": 33, "name": "The Bear & Ragged Staff, Cumnor", "city": "Oxford", "image": "N/A", "price": 0, "expires": "N/A", "location": "28, Appleton Road, Cumnor, Oxford, OX2 9QH", "phone": "1865862329", "description": "20% off food and beverage\n\nUnpretentious with accommodation in the Oxfordshire countryside just about sums up The Bear & Ragged Staff serves fantastic food throughout the day, and recently completed a conversion to a Inn with the opening of 5 rooms. The Bear is now in a position to offer a full suite of services to travellers on business, a romantic getaway or just looking for a home away from home for a few days.\n\nThe restaurant was awarded the AA Rosette for culinary excellence and is constantly top rated in the Trip Advisor rankings.\n\nWith the addition of its new rooms all featuring internet access, flat screen TVs, en-suite bathrooms, king sized beds and Olde Worlde character it has now added a new dimension to the Bear experience.\n\nThe Inn also boasts award winning ales, a play area and garden, comfy outdoor decking and ample parking.\n\nHow to get this offer\n\nJust fill in the form below. We'll send you a voucher by email, with instructions on how to redeem it. When you use the offer, you'll also need to show a GWR train ticket (or proof of travel on a GWR train) from the previous 7 days.\n\nOffer details: Terms and conditions\nNot valid from 5pm Fridays to 5pm Sundays, Mother's Day and all public holidays.", "website": "https://www.gwr.com/explore-the-west/offers/2016/march/the-bear-and-ragged-staff-cumnor", "type": "Places to eat / Places to stay", "theme": "Food lovers", "coords": [51.733315, -1.337027] }, "route": { "departure": "2016-05-02T11:00:35.000+02:00", "arrival": "2016-05-02T12:42:59.000+02:00", "time": 6144, "distance": 1345, "num_trips": 3, "parts": [{ "mode": "walk", "coords": [[51.51, -0.14]], "directions": "Start your journey 16 meters west", "distance": 16, "time": 11, "direction": "west", "id": 0 }, { "mode": "walk", "coords": [[51.5099924, -0.1402405], [51.5100947, -0.1399182], [51.510121, -0.1398087], [51.510128, -0.1396831]], "directions": "Walk 41 meters along Burlington Gardens", "distance": 41, "time": 30, "road": "Burlington Gardens", "id": 1 }, { "mode": "walk", "coords": [[51.510128, -0.1396831], [51.5101593, -0.1395111], [51.5102629, -0.1389583], [51.5103655, -0.1384156]], "directions": "Continue onto Vigo Street for 91 meters", "distance": 91, "time": 75, "road": "Vigo Street", "turn": "straight", "id": 2 }, { "mode": "walk", "coords": [[51.5103655, -0.1384156], [51.5103283, -0.1383792], [51.5102766, -0.1383082], [51.5101624, -0.1381542], [51.5100703, -0.1379606], [51.5099827, -0.1377347], [51.5099618, -0.1376909], [51.5099151, -0.1375237], [51.5098722, -0.1373361], [51.5098325, -0.1371314], [51.5098129, -0.1369727], [51.5097959, -0.136879], [51.5097732, -0.1366245], [51.5097719, -0.1363498], [51.5097827, -0.1361221], [51.5097933, -0.1360069], [51.5098171, -0.1358443], [51.5098417, -0.1356675], [51.5098944, -0.1354104], [51.5099342, -0.1352801]], "directions": "Slight right and walk 238 meters", "distance": 238, "time": 174, "turn": "slight_right", "id": 3 }, { "mode": "walk", "coords": [[51.5099342, -0.1352801], [51.509925194, -0.1352547226], [51.5100874169, -0.1352769206]], "directions": "Enter 'Piccadilly Circus Underground Station' through 'Entrance 2'", "distance": 20, "time": 303, "id": 4 }, { "mode": "rail_underground", "coords": [[51.5100874169, -0.1352769206], [51.5157014991, -0.1422398124], [51.5231576241, -0.146289831], [51.5232425609, -0.1573863771], [51.5221239893, -0.1634715083], [51.5204586891, -0.1702701646], [51.5163499149, -0.1755227669]], "directions": "Take a train (Bakerloo line) from 'Piccadilly Circus Underground Station' (leaves at 10:10) to 'Paddington Underground Station' (arrives at 10:15) (6 stops)", "distance": 0, "time": 309, "line": "Bakerloo", "departure_station": "Piccadilly Circus Underground Station", "arrival_station": "Paddington Underground Station", "depart_time": "10:10", "arrive_time": "10:15", "num_stops": 6, "id": 5 }, { "mode": "walk", "coords": [[51.5163499149, -0.1755227669], [51.5160002879, -0.1761709225]], "directions": "Change stop", "distance": 59, "time": 300, "id": 6 }, { "mode": "rail_national", "coords": [[51.5160002879, -0.1761709225], [51.5118768916, -0.591504981], [51.4587818857, -0.9718543742], [51.7535007473, -1.2701511727]], "directions": "Take a train (London Paddington Rail Station - Hereford Rail Station (of First Great Western) line) from 'London Paddington Rail Station' (leaves at 10:22) to 'Oxford Rail Station' (arrives at 11:17) (3 stops)", "distance": 0, "time": 3383, "line": "London Paddington Rail Station - Hereford Rail Station (of First Great Western)", "departure_station": "London Paddington Rail Station", "arrival_station": "Oxford Rail Station", "depart_time": "10:22", "arrive_time": "11:17", "num_stops": 3, "id": 7 }, { "mode": "walk", "coords": [[51.7535007473, -1.2701511727], [51.7534708963, -1.2696880591], [51.7534574, -1.269722]], "directions": "Exit 'Oxford Rail Station' through 'entrance'", "distance": 34, "time": 124, "id": 8 }, { "mode": "walk", "coords": [[51.7534574, -1.269722], [51.7534286, -1.2697132], [51.7530954, -1.2696115], [51.7531368, -1.2692443], [51.7531435, -1.2691857], [51.7531514, -1.2691164], [51.7531609, -1.2690497], [51.7530171, -1.2688582], [51.752968, -1.2688216], [51.7529863, -1.2686664]], "directions": "Walk 113 meters", "distance": 113, "time": 83, "id": 9 }, { "mode": "walk", "coords": [[51.7529863, -1.2686664], [51.7527617027, -1.2684246323]], "directions": "Go to 'Frideswide Square, Stop F2'", "distance": 29, "time": 43, "id": 10 }, { "mode": "bus", "coords": [[51.7527617027, -1.2684246323], [51.7524126372, -1.274485837], [51.7523932509, -1.2801070984], [51.7527348109, -1.2845057438], [51.7530210357, -1.2887025031], [51.7532485459, -1.2921324073], [51.7516763933, -1.2983573116], [51.7493752177, -1.3029995166], [51.7459724364, -1.3084113038], [51.7418164064, -1.3111397392], [51.7378328635, -1.3157043099], [51.7364930162, -1.3187802225], [51.7349892759, -1.323074842], [51.7342246406, -1.326141787], [51.7340783846, -1.3288664077]], "directions": "Take a bus (X30) from 'Frideswide Square' (leaves at 11:23) to 'Glebe Road' (arrives at 11:34) (14 stops)", "distance": 0, "time": 788, "line": "X30", "departure_station": "Frideswide Square", "arrival_station": "Glebe Road", "depart_time": "11:23", "arrive_time": "11:34", "num_stops": 14, "id": 11 }, { "mode": "walk", "coords": [[51.7340783846, -1.3288664077], [51.73412, -1.3289211]], "directions": "", "distance": 5, "time": 9, "id": 12 }, { "mode": "walk", "coords": [[51.73412, -1.3289211], [51.7341431, -1.329251], [51.734191, -1.329539], [51.7341955, -1.3296111]], "directions": "Walk 47 meters along Oxford Road", "distance": 47, "time": 34, "road": "Oxford Road", "id": 13 }, { "mode": "walk", "coords": [[51.7341955, -1.3296111], [51.7343444, -1.3305249], [51.734433, -1.3310803], [51.734443, -1.3312126], [51.734468, -1.3315456], [51.7344995, -1.3324861], [51.7344892, -1.332766], [51.7344794, -1.3330951]], "directions": "Continue onto Oxford Road (B4017) for 242 meters", "distance": 242, "time": 173, "road": "Oxford Road (B4017)", "turn": "straight", "id": 14 }, { "mode": "walk", "coords": [[51.7344794, -1.3330951], [51.7344801, -1.3331824], [51.7345224, -1.3337168], [51.7345773, -1.3340535], [51.7346921, -1.3346271], [51.7347653, -1.3349001]], "directions": "Continue onto High Street (B4017) for 128 meters", "distance": 128, "time": 103, "road": "High Street (B4017)", "turn": "straight", "id": 15 }, { "mode": "walk", "coords": [[51.7347653, -1.3349001], [51.7346603, -1.335664], [51.734531, -1.3359665], [51.7345184, -1.3359964], [51.7342826, -1.336167], [51.73389, -1.3363202], [51.7332631, -1.3366166]], "directions": "Slight left onto Appleton Road and walk 227 meters", "distance": 227, "time": 163, "road": "Appleton Road", "turn": "slight_left", "id": 16 }, { "mode": "walk", "coords": [[51.7332631, -1.3366166], [51.7333267, -1.3368617], [51.7334798, -1.3368871]], "directions": "Turn right and walk 35 meters", "distance": 35, "time": 25, "turn": "right", "id": 17 }, { "mode": "walk", "coords": [[51.733315, -1.337027]], "directions": "Your destination is 20 meters southwest", "distance": 20, "time": 14, "direction": "southwest", "id": 18 }], "fares": [], "fares_total": [] }, "travel_time": 6144, "first_station": "London Paddington Rail Station", "departure_time": "10:22", "last_station": "Oxford Rail Station" }, { "event": { "id": 117, "name": "The Museum of Bath at Work", "city": "Bath", "image": "/~/media/gwr/offers/offer-in-article/winter-offers/themuseumofbathatworkbath-jumbo@2x.jpg')", "price": 0, "expires": "N/A", "location": "Julian Road\nBATH\nBA1 2RH", "phone": "01225 318348", "description": "2 for 1 entry\n\nBath is an ancient city, with a history stretching back to Roman times and beyond. Learn more about this rich history at the Museum of Bath at Work, telling the tale of 2000 years of the city’s development.\n\nExplore a reconstructed Bath Stone mine, discover what it was like to work in a Victorian furniture making works, soft drinks factory, and an engineering works. Learn about the city’s famous Bath Chairs, and see a 1915 Horstmann car that was built in the city.\n\nYou’ll be given a free audio guide to help you make the most of your visit, and the museum also has a café.\n\nHow to get this offer\n\nJust fill in the form below. We'll send you a voucher by email, with instructions on how to redeem it. When you use the offer, you'll also need to show a GWR train ticket (or proof of travel on a GWR train) from the previous 7 days.\n\nOffer details: Terms and conditions\n\n2 for 1 entry on production of proof of participation in the scheme", "website": "https://www.gwr.com/explore-the-west/offers/2015/december/museum-of-bath-at-work", "type": "Things to do", "theme": "City break / Family fun / History and heritage", "coords": [51.388029, -2.364729] }, "route": { "departure": "2016-05-02T11:00:35.000+02:00", "arrival": "2016-05-02T13:18:25.000+02:00", "time": 8270, "distance": 1607, "num_trips": 3, "parts": [{ "mode": "walk", "coords": [[51.51, -0.14]], "directions": "Start your journey 16 meters west", "distance": 16, "time": 11, "direction": "west", "id": 0 }, { "mode": "walk", "coords": [[51.5099924, -0.1402405], [51.5100947, -0.1399182], [51.510121, -0.1398087], [51.510128, -0.1396831]], "directions": "Walk 41 meters along Burlington Gardens", "distance": 41, "time": 30, "road": "Burlington Gardens", "id": 1 }, { "mode": "walk", "coords": [[51.510128, -0.1396831], [51.5101593, -0.1395111], [51.5102629, -0.1389583], [51.5103655, -0.1384156]], "directions": "Continue onto Vigo Street for 91 meters", "distance": 91, "time": 75, "road": "Vigo Street", "turn": "straight", "id": 2 }, { "mode": "walk", "coords": [[51.5103655, -0.1384156], [51.5103283, -0.1383792], [51.5102766, -0.1383082], [51.5101624, -0.1381542], [51.5100703, -0.1379606], [51.5099827, -0.1377347], [51.5099618, -0.1376909], [51.5099151, -0.1375237], [51.5098722, -0.1373361], [51.5098325, -0.1371314], [51.5098129, -0.1369727], [51.5097959, -0.136879], [51.5097732, -0.1366245], [51.5097719, -0.1363498], [51.5097827, -0.1361221], [51.5097933, -0.1360069], [51.5098171, -0.1358443], [51.5098417, -0.1356675], [51.5098944, -0.1354104], [51.5099342, -0.1352801]], "directions": "Slight right and walk 238 meters", "distance": 238, "time": 174, "turn": "slight_right", "id": 3 }, { "mode": "walk", "coords": [[51.5099342, -0.1352801], [51.509925194, -0.1352547226], [51.5100874169, -0.1352769206]], "directions": "Enter 'Piccadilly Circus Underground Station' through 'Entrance 2'", "distance": 20, "time": 303, "id": 4 }, { "mode": "rail_underground", "coords": [[51.5100874169, -0.1352769206], [51.5157014991, -0.1422398124], [51.5231576241, -0.146289831], [51.5232425609, -0.1573863771], [51.5221239893, -0.1634715083], [51.5204586891, -0.1702701646], [51.5163499149, -0.1755227669]], "directions": "Take a train (Bakerloo line) from 'Piccadilly Circus Underground Station' (leaves at 10:10) to 'Paddington Underground Station' (arrives at 10:15) (6 stops)", "distance": 0, "time": 309, "line": "Bakerloo", "departure_station": "Piccadilly Circus Underground Station", "arrival_station": "Paddington Underground Station", "depart_time": "10:10", "arrive_time": "10:15", "num_stops": 6, "id": 5 }, { "mode": "walk", "coords": [[51.5163499149, -0.1755227669], [51.5160002879, -0.1761709225]], "directions": "Change stop", "distance": 59, "time": 300, "id": 6 }, { "mode": "rail_national", "coords": [[51.5160002879, -0.1761709225], [51.4587818857, -0.9718543742], [51.610955041, -1.2428912961], [51.5654729255, -1.7855101034], [51.4624863756, -2.115402682], [51.3776827625, -2.3570341779]], "directions": "Take a train (London Paddington Rail Station - Bristol Temple Meads Rail Station (of First Great Western) line) from 'London Paddington Rail Station' (leaves at 10:30) to 'Bath Spa Rail Station' (arrives at 11:59) (5 stops)", "distance": 0, "time": 5903, "line": "London Paddington Rail Station - Bristol Temple Meads Rail Station (of First Great Western)", "departure_station": "London Paddington Rail Station", "arrival_station": "Bath Spa Rail Station", "depart_time": "10:30", "arrive_time": "11:59", "num_stops": 5, "id": 7 }, { "mode": "walk", "coords": [[51.3776827625, -2.3570341779], [51.3777186419, -2.3570631934], [51.3777041, -2.35706]], "directions": "Exit 'Bath Spa Rail Station' through 'Entrance'", "distance": 5, "time": 122, "id": 8 }, { "mode": "walk", "coords": [[51.3777041, -2.35706], [51.3777007, -2.3571152], [51.3776993, -2.3571366], [51.3776984, -2.3571481], [51.3776979, -2.3571651], [51.3776982, -2.3571769], [51.3776985, -2.3571867], [51.3777003, -2.3571932]], "directions": "Walk 8 meters", "distance": 8, "time": 7, "id": 9 }, { "mode": "walk", "coords": [[51.3777003, -2.3571932], [51.3777817, -2.3571932], [51.3778048, -2.3572635], [51.3778794, -2.3574904], [51.377889, -2.357889]], "directions": "Turn right onto Brunel Square and walk 58 meters", "distance": 58, "time": 43, "road": "Brunel Square", "turn": "right", "id": 10 }, { "mode": "walk", "coords": [[51.377889, -2.357889], [51.3778601429, -2.3578401796]], "directions": "Go to 'Dorchester Street, Bh'", "distance": 4, "time": 7, "id": 11 }, { "mode": "bus", "coords": [[51.3778601429, -2.3578401796], [51.3783311657, -2.3625710545], [51.3802538375, -2.3630891598]], "directions": "Take a bus (U1) from 'Dorchester Street' (leaves at 12:02) to 'Avon Street' (arrives at 12:04) (2 stops)", "distance": 0, "time": 148, "line": "U1", "departure_station": "Dorchester Street", "arrival_station": "Avon Street", "depart_time": "12:02", "arrive_time": "12:04", "num_stops": 2, "id": 12 }, { "mode": "walk", "coords": [[51.3802538375, -2.3630891598], [51.3804892, -2.362991]], "directions": "", "distance": 27, "time": 39, "id": 13 }, { "mode": "walk", "coords": [[51.3804892, -2.362991], [51.3812097, -2.3628924]], "directions": "Walk 80 meters along Avon Street", "distance": 80, "time": 57, "road": "Avon Street", "id": 14 }, { "mode": "walk", "coords": [[51.3812097, -2.3628924], [51.3811636919, -2.3625503261], [51.3813765, -2.3624368]], "directions": "Enter 'Westgate Buildings' through 'Wd'", "distance": 48, "time": 71, "id": 15 }, { "mode": "walk", "coords": [[51.3813765, -2.3624368], [51.3813941, -2.3624733], [51.3814192, -2.3624903], [51.3814683, -2.362496], [51.381651, -2.3625172], [51.3817132, -2.3625098], [51.381764, -2.3624852], [51.3818839, -2.3624272], [51.3819717, -2.3624116], [51.3819978, -2.3624137]], "directions": "Walk 69 meters along Saw Close", "distance": 69, "time": 51, "road": "Saw Close", "id": 16 }, { "mode": "walk", "coords": [[51.3819978, -2.3624137], [51.3822162, -2.3624509]], "directions": "Continue straight for 24 meters", "distance": 24, "time": 17, "turn": "straight", "id": 17 }, { "mode": "walk", "coords": [[51.3822162, -2.3624509], [51.3822555, -2.3624954], [51.3824745, -2.3626114], [51.3824946, -2.3626203], [51.3828147, -2.3627465], [51.3831164, -2.3628658], [51.3831444, -2.3628686], [51.3831641, -2.3628575]], "directions": "Slight left onto Barton Street and walk 107 meters", "distance": 107, "time": 79, "road": "Barton Street", "turn": "slight_left", "id": 18 }, { "mode": "walk", "coords": [[51.3831641, -2.3628575], [51.3831748, -2.3629003], [51.3831836, -2.3629443], [51.3831904, -2.362988]], "directions": "Turn left and walk 9 meters", "distance": 9, "time": 7, "turn": "left", "id": 19 }, { "mode": "walk", "coords": [[51.3831904, -2.362988], [51.3832242, -2.3629832], [51.3832453, -2.3629832], [51.3838178, -2.3632013]], "directions": "Turn right onto Queen Square (A4) and walk 71 meters", "distance": 71, "time": 61, "road": "Queen Square (A4)", "turn": "right", "id": 20 }, { "mode": "walk", "coords": [[51.3838178, -2.3632013], [51.3843983, -2.3634254], [51.3845649, -2.3634904]], "directions": "Continue onto Gay Street (A4) for 85 meters", "distance": 85, "time": 61, "road": "Gay Street (A4)", "turn": "straight", "id": 21 }, { "mode": "walk", "coords": [[51.3845649, -2.3634904], [51.3856469, -2.3639149]], "directions": "Continue onto Gay Street for 123 meters", "distance": 123, "time": 88, "road": "Gay Street", "turn": "straight", "id": 22 }, { "mode": "walk", "coords": [[51.3856469, -2.3639149], [51.38569, -2.3637726], [51.385765, -2.363637], [51.385862, -2.363568], [51.3859289, -2.3635493], [51.3860131, -2.3635466], [51.3861002, -2.3635824], [51.3861806, -2.3636554]], "directions": "Turn right onto The Circus and walk 71 meters", "distance": 71, "time": 52, "road": "The Circus", "turn": "right", "id": 23 }, { "mode": "walk", "coords": [[51.3861806, -2.3636554], [51.3864482, -2.363258], [51.386491, -2.3631862], [51.3865087, -2.3631272], [51.3865715, -2.3627313]], "directions": "Turn right onto Bennett Street and walk 79 meters", "distance": 79, "time": 57, "road": "Bennett Street", "turn": "right", "id": 24 }, { "mode": "walk", "coords": [[51.3865715, -2.3627313], [51.3874505, -2.3630465]], "directions": "Turn left onto Russell Street and walk 100 meters", "distance": 100, "time": 72, "road": "Russell Street", "turn": "left", "id": 25 }, { "mode": "walk", "coords": [[51.3874505, -2.3630465], [51.3874847, -2.3628052], [51.3874994, -2.3627554], [51.3875426, -2.3627021]], "directions": "Turn right onto Rivers Street and walk 27 meters", "distance": 27, "time": 19, "road": "Rivers Street", "turn": "right", "id": 26 }, { "mode": "walk", "coords": [[51.3875426, -2.3627021], [51.387559, -2.3627673], [51.3877238, -2.3634169], [51.3879331, -2.3642838], [51.387976, -2.3644489], [51.387993, -2.3645136]], "directions": "Turn left onto Julian Road and walk 132 meters", "distance": 132, "time": 96, "road": "Julian Road", "turn": "left", "id": 27 }, { "mode": "walk", "coords": [[51.388029, -2.364729]], "directions": "Your destination is 15 meters west", "distance": 15, "time": 11, "direction": "west", "id": 28 }], "fares": [], "fares_total": [] }, "travel_time": 8270, "first_station": "London Paddington Rail Station", "departure_time": "10:30", "last_station": "Bath Spa Rail Station" }];
        // deferred.resolve(this.events);

        return deferred.promise;
      }

      public getThingToDo(id) {

        var deferred = this.$q.defer();

        for (var i = 0; i < this.events.length; i++) {
          if(this.events[i].event.id.toString() === id) {
            deferred.resolve(this.events[i]);
            return deferred.promise;
          }
        }

        deferred.reject();
        return deferred.promise;
      }

      public pickNewLocationModal() {

        var deferred = this.$q.defer();

        var modalLocation = "app/things-to-do/location-picker/";
        var modalTemplate = "location-picker.html";
        var modalScope = this.$rootScope.$new(true); // True makes scope isolated

        this.$ionicModal
          .fromTemplateUrl(modalLocation + modalTemplate, {
            scope: modalScope,
            animation: "slide-in-up"
          })
          .then((modal) => {
            modalScope.modal = modal;
            modalScope.modal.show();
          });

        modalScope.$on("$destroy", () => {
          modalScope.modal.remove();
        });
        modalScope.$on('modal.hidden', () => {
          modalScope.$destroy();
        });
        modalScope.$on('modal.removed', () => {
          deferred.resolve(modalScope.modal.locationChosen)
          modalScope.$destroy();
        });

        return deferred.promise;
      }

    }

    angular.module('thingsToDo')
    .service('thingsToDo.thingsToDoService', ThingsToDoService)


} // Ticketing
} // RailTech